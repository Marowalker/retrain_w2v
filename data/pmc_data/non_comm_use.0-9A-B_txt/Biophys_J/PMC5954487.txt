
==== Front
Biophys JBiophys. JBiophysical Journal0006-34951542-0086The Biophysical Society S0006-3495(18)30295-910.1016/j.bpj.2018.02.035Computational ToolPAM: A Framework for Integrated Analysis of Imaging, Single-Molecule, and Ensemble Fluorescence Data Schrimpf Waldemar 1Barth Anders 1Hendrix Jelle 23Lamb Don C. d.lamb@lmu.de1∗1 Department of Physical Chemistry, Center for Integrated Protein Science Munich (CIPSM), Nanosystems Initiative Munich (NIM) and Center for Nanoscience (CeNS), Ludwig-Maximilians-Universität, Munich, Germany2 Dynamic Bioimaging Lab, Biomedical Research Institute (BIOMED), Advanced Optical Microscopy Centre, Faculty of Medicine and Life Sciences, Hasselt University, Diepenbeek, Belgium3 Laboratory for Photochemistry and Spectroscopy, Molecular Imaging and Photonics Division, KU Leuven, Heverlee, Belgium∗ Corresponding author d.lamb@lmu.de10 4 2018 10 4 2018 114 7 1518 1528 6 11 2017 12 2 2018 © 2018 Biophysical Society.2018Biophysical SocietyThis is an open access article under the CC BY-NC-ND license (http://creativecommons.org/licenses/by-nc-nd/4.0/).Fluorescence microscopy and spectroscopy data hold a wealth of information on the investigated molecules, structures, or organisms. Nowadays, the same fluorescence data set can be analyzed in many ways to extract different properties of the measured sample. Yet, doing so remains slow and cumbersome, often requiring incompatible software packages. Here, we present PAM (pulsed interleaved excitation analysis with MATLAB), an open-source software package written in MATLAB that offers a simple and efficient workflow through its graphical user interface. PAM is a framework for integrated and robust analysis of fluorescence ensemble, single-molecule, and imaging data. Although it was originally developed for the analysis of pulsed interleaved excitation experiments, PAM has since been extended to support most types of data collection modalities. It combines a multitude of powerful analysis algorithms, ranging from time- and space-correlation analysis, over single-molecule burst analysis, to lifetime imaging microscopy, while offering intrinsic support for multicolor experiments. We illustrate the key concepts and workflow of the software by discussing data handling and sorting and provide step-by-step descriptions for the individual usage cases.

Editor: Jochen Mueller.
==== Body
Introduction
Fluorescence microscopy and spectroscopy have become important tools in the life and material sciences over the past decades. Research institutes nowadays often house high-end fluorescence microscopes for recording fluorescence time traces and multicolor images or time-lapse videos. The recorded data convey a wealth of information that is encoded in the multidimensional parameter space of the fluorescence signal (1), and many advanced analysis methods have been developed over the past decades. Among the properties of the fluorescence signal are fundamental parameters, such as time, space, fluorescence lifetime, polarization, and spectrum, as well as derived parameters, including molecular brightness, labeling stoichiometry, and distances between fluorescent labels (2). Further information on diffusion, flow, and molecular interactions is encoded in the seemingly random fluctuations of the fluorescence signal, which can be extracted using the many variants of fluorescence fluctuation spectroscopy (3, 4). Because each individual method only analyzes a fraction of the information contained in the data, a global understanding of the system is only possible by performing a combined analysis.

An illustration of how a combined analysis can lead to synergetic insights is single-molecule Förster resonance energy transfer (FRET) by burst extraction (2, 5, 6). With this method, intra- and intermolecular distances can be accurately measured on the nanometer scale based on the signal intensities in the FRET donor and acceptor detection channels. Additional parameters such as the fluorescence lifetime, anisotropy, or labeling stoichiometry are typically used to gain valuable information about properties and dynamics of the studied sample. Photon distribution analysis (PDA) enables a quantitative analysis of conformational heterogeneity and conformer interconversion kinetics (7, 8). This information can be supplemented by subensemble fluorescence correlation spectroscopy (FCS), which provides additional information on biomolecular hydrodynamic properties (9). Conformational changes can also be evaluated using filtered-FCS (10), making it possible to investigate dynamics between the different species on the nanosecond to the millisecond timescale.

Another good illustration of an integrated quantitative sample analysis comes from confocal imaging. Instead of only addressing the average signal, fluorescence fluctuations in the recorded images can be analyzed to investigate protein mobility and interactions (11, 12, 13, 14, 15, 16, 17, 18). Correlating the signal through space and time (or both) can extract valuable information about the spatial distribution or the diffusion of the fluorescent molecules. By analyzing the image cross correlation function, one can study molecular interactions more accurately than with intensity-based colocalization analysis. Finally, fluorescence lifetime imaging allows one to study both the local environment and the molecular interactions in cells, and, by combining this information with fluctuation analysis, even the dynamics of subspecies in complex mixtures can be investigated (16).

As it has become customary to openly provide the respective software with publications, a multitude of software for analyzing advanced fluorescence data are available. However, these programs are often too specific, complex, or inflexible to provide the user with a clear approach to a global data analysis. Software attached to the publication of new methods is generally designed specifically for that single application and often also requires a particular file format to work. This makes it highly impractical and cumbersome to employ multiple methods, as they necessitate the use of different software and reformatting of the data. Although script-based implementation of such applications allows for easier adjustment to new projects or hardware, it also makes them difficult to apply for the novice user without programming experience. Conversely, implementations of advanced analysis methods by microscope manufacturers are expensive, usually only offer a basic framework excluding customization options, and are incompatible with data generated by other microscopy hardware. Lastly, commercial software is hardly ever designed by the end users, who logically have a better understanding of what is needed for a proper analysis of the data. Open-source development, on the other hand, offers the possibility for both experts and end users to improve and extend existing software packages by implementing their newest methods. As such, it provides a platform for the continuous development and extension of the software, enabling researchers to join efforts on new developments. In recent years, a number of software packages in the field of single-molecule fluorescence have been made openly available (19, 20, 21, 22). For an optimal workflow incorporating multiple analysis techniques, one requires a fast and easy-to-use software framework that implements the various methods but is also designed to provide an efficient communication between the different modules.

Here, we present PAM (pulsed interleaved excitation (PIE) analysis with MATLAB (The MathWorks, Natwick, MA)), an open-source software package that combines leading quantitative fluorescence microscopy and spectroscopy analysis methods and offers an integrated and extendible support for multiparameter and multicolor experiments. The three main applications of PAM are 1) ensemble spectroscopy, including correlation spectroscopy, and fluorescence lifetime and anisotropy analysis; 2) single-molecule analysis; and 3) image analysis (Fig. 1). To the best of our knowledge, PAM is the only program that implements all three of these fields in a single software package. PAM implements state-of-the-art signal processing algorithms commonly used for quantitative analysis of fluorescence experiments, i.e., fluctuation spectroscopy (FCS, fluorescence cross correlation spectroscopy, fluorescence lifetime correlation spectroscopy, nanosecond FCS, filtered-FCS, and pair-correlation) (23, 24, 25), burst-wise single-molecule analysis (including Förster resonance energy transfer and PDA) (5, 7, 26), fluorescence lifetime imaging microscopy (FLIM) via the phasor approach (27), and fluctuation imaging (image correlation spectroscopy (ICS), raster ICS (RICS), cross correlation RICS, number and brightness analysis, temporal ICS (TICS), arbitrary region RICS, image mean-square displacement (iMSD), and spatiotemporal ICS (STICS)) (15, 16, 28).Figure 1 Overview of the functionalities of the PAM software package. Photon sorting is performed in the main module PAM. The main applications are divided into three areas: ensemble spectroscopy (top), single-molecule spectroscopy (left), and image-based analysis methods (right). Each area incorporates a number of analysis methods. FCS, fluorescence correlation spectroscopy; spFRET, single-pair Förster resonance energy transfer; MFD, multiparameter fluorescence detection; PDA, photon distribution analysis; ICS, image correlation spectroscopy; RICS, raster image correlation spectroscopy; FLIM, fluorescence lifetime imaging microscopy. To see this figure in color, go online.



Results and Discussion
Motivation and key concepts
The motivation for designing and publishing PAM is to provide 1) an easy-to-use software package with 2) a high degree of automation that is 3) compatible with a variety of measurement schemes and setups. This program allows the user to perform 4) a variety of different quantitative fluorescence analysis techniques on the same data set, including 5) several unique and cutting-edge methods and variants. At the same time, the program should be 6) versatile and adaptable by the expert user. A brief description of implementation of these points is given in the following paragraphs.

Ease-of-use
To be adopted by a broad variety of users, an analysis software needs to be fast and easy to learn and have a clear workflow with feedback about the current state of the progress and the data. To achieve this simplicity and to streamline the workflow, PAM has a modular structure (Fig. 2). It is divided into the core PAM program used for data sorting and (pre)processing and several modules for the individual method groups. All these subprograms are based on graphical user interfaces (GUIs) that clearly show the possible actions that can be taken and display all relevant information about the data. PAM is highly configurable both for defining specific workflows as well as for displaying data. All these settings are stored in custom profiles, allowing the user to quickly switch between settings for different microscopes or techniques. After each step in the analysis, the data can be saved in an intermediate file format, giving the user the possibility to reanalyze the data at a later time point without the need of reprocessing. Additionally, all important parameters and plots can be exported to external programs (e.g., Excel, Origin, ImageJ, etc.) or as ready-for-publication figures.Figure 2 Schematic representation of the data- and workflow of PAM, showing the connection between the modules of PAM (blue), general file formats for use with spreadsheet programs, text editors or image processing tools (red), and the MATLAB command line functionalities (green). To see this figure in color, go online.



Automation
Advanced fluorescence techniques often require the analysis of many large data sets. Analyzing each measurement individually results in the user spending a significant time just waiting for the computer to load or process the data. To mitigate this problem, PAM contains a batch analysis option for most computationally intensive steps that require no or low direct user interaction. Hereby, the user sets up the parameters for the analysis and PAM automatically performs the calculations (e.g., burst-extraction or correlation) sequentially for all selected datasets with the same settings. Additionally, all computationally demanding algorithms are written in C++ and can run on multiple cores to decrease calculation times and optimize performance.

Compatibility
The methods in PAM are meant to be applicable to all fluorescence data and independent of the microscope or the file format used. For this, PAM includes read-in methods for all common time-correlated single-photon-counting (TCSPC) formats (e.g., Becker&Hickl .spc, Picoquant .ptu, etc.), which are the main data type used for many methods. However, PAM does not necessarily require TCSPC data and is compatible with simple photon counting and, to some extent, prebinned data. A detailed list is given in the Supporting Material. All imaging methods additionally support direct loading of tagged image file format (TIFF)-based data, extending the capabilities to camera-based microscopes. Although these options already cover a large fraction of file formats, they cannot possibly include all commercial and, especially, home-built microscopes and setups. For this, PAM has a dedicated option for custom read-in functions, which allows the user to dynamically add their own read-in functions without having to modify the central code.

Integrated methods
One of the key concepts of PAM is the combination of the various methods in a single platform. This encourages the user to explore multiple aspects of the data simultaneously, which, in our experience, is an important step to fully understanding complex biological systems. A good example for the benefits of combining different techniques is our recent study on the early steps of human immunodeficiency virus assembly (29).

Unique methods
PAM is not only a collection of established techniques; it is constantly updated and expanded and contains many cutting-edge methods and variations not available in any other software. One key feature of PAM is that all its methods are fully compatible with PIE (23), the historic origin of the name PAM. Even though it has been introduced more than 10 years ago, the widespread application of PIE is still limited despite its benefits for quantitative multicolor fluorescence (cross)correlation spectroscopy. Although many researchers are in possession of PIE-capable microscopes, few are actively taking advantage of them because of the lack of readily available software implementations. As PAM has a strong focus on TCSPC data, it also includes the option to correct for count-rate-dependent shifts of the instrument response function (30). For multicolor FRET, PIE or alternating laser excitation (ALEX) (31) is essential for determining all interdye distances (32, 33). The burst analysis framework in PAM offers full support for three-color FRET experiments, including specific three-color burst search methods and calculation of advanced parameters. Another unique method of PAM is the recently developed arbitrary region RICS (15). This extension to the standard image correlation techniques decreases the requirements for the image quality in terms of spatial shape and heterogeneity. By filtering the data to remove unwanted contributions, it increases the amount of usable data and allows the accurate measurement of (co)diffusion even in highly dynamic and heterogeneous systems.

Adaptability
The field of fluorescence spectroscopy and microscopy is highly specialized and dynamic, and almost every new project requires a modification of the approaches and methods employed. PAM uses several different concepts to achieve a flexible workflow. One approach is that, in most cases, the fit models are based on simple text files instead of being hard-coded. This allows the user to create their own models or modify existing functions even without programming experience. The expert users, on the other hand, can make use of the open-source nature of PAM and adjust the code to their own needs. The modular structure of PAM and its use of MATLAB-based file formats help to simplify this process. The user can simply use the (intermediary) data in their own scripts or insert new functions into the dataflow between existing modules. For small modifications or experimental prototyping, they can exploit the advantages of MATLAB as an interpreted language and its powerful command-line capabilities to tweak the code on the fly. For this, PAM allows quick access to the data in the form of global variables. For larger and permanent modifications, PAM uses the Git version control system for distributed development. Active involvement and improvements by the users, e.g., by pointing out bugs, suggesting improvements, or even adding functionalities, is not only accepted but also encouraged.

Because of the large number of different methods included in PAM, we cannot describe all techniques and processes in detail. Instead, we provide a basic description of the workflow for the main functionalities in the PAM software package: data inspection, sorting and preprocessing, FCS, image fluctuation analysis, burst-wise single-molecule analysis, and fluorescence lifetime imaging using the phasor approach. A more detailed description of the individual functionalities, the algorithms involved, and the particular GUIs and controls is presented in the manual (see Availability and Supporting Material). Additionally, we provide verification of all presented functionalities using simulated data (Table S1).

PAM core functionalities
In most cases, the analysis starts with the core module PAM. The main function of this core module is to load raw data and to sort the photon records based on the detection and the excitation channel (Fig. 3). This main program is meant to work with confocal single photon counting data, with a focus on TCSPC data. However, by using the custom read-in option, it is also possible to work with non-TCSPC or even binned data. Processed imaging data from scanning or widefield microscopes, on the other hand, do not have to go through the core module at all and can be loaded directly into the image processing subprograms.Figure 3 Photon-sorting in the PAM main module. (A) In two-color pulsed interleaved excitation (PIE), two lasers are alternated on the nanosecond timescale such that every synchronization period contains both laser pulses. The TCSPC data format records the macro-time (time passed since the start of the measurement in units of the synchronization clock), the micro-time (time between photon detection and the last synchronization signal), and the color channel in which the photon was detected in (B). In PIE, the micro-time information is used to sort the macro-time stamps using photon gates defined by the excitation source and the detected color channel. GG, green excitation, green detection; GR, green excitation, red detection (FRET, cross talk, cross-excitation); RR, red excitation, red detection. (C) The workflow in PAM for photon sorting is shown. The raw data (e.g., ∗.spc or ∗.ptu file formats) are loaded into PAM. Extracted setup parameters (e.g., synchronization clock frequency) are stored in the global variable FileInfo, and photon records (i.e., the macro-time, micro-time, and channel) are stored in TcspcData. The micro-time histograms are used to define the time ranges for the different photon gates, and photons are assigned accordingly before being processed further. (D) The main graphical user interface of PAM used to sort photons by photon gates is shown. Top left: a list of photon channels and controls for photon gate definition is shown. Bottom left: the count rate as a function of time for the selected channel is shown. Right: a micro-time histogram of the detectors with the defined photon gates GG (green), GR (orange), and RR (red, shaded areas) is shown. To see this figure in color, go online.



Once the data is loaded, each photon record is first assigned to a detection module and, if applicable, a routing channel. These correspond to the physical detectors used for e.g., the different spectral ranges or polarizations. Additionally, photon records are defined by two parameters. The first is the macro-time or the arrival time of the photon relative to the start of the experiment, in multiples of the synchronization clock. The second value can be used to encode a variety of parameters, e.g., the spectral information or the ALEX channel, but is most commonly used to store the micro-time data (Fig. 3
A). The micro-time is the photon arrival time relative to the synchronization source, encoding, for example, the fluorescence lifetime. PAM uses this secondary parameter to sort the photons into different photon gates (Fig. 3
B). When PIE is used, this micro-time information allows the user to further separate the signal by the excitation source.

Based on these detector and photon gates, the program displays intensity traces, photon arrival time, histograms, histograms, photon counting histograms, and images that can be used for a first data evaluation (Fig. 3, C and D). The photon sorting is followed by one or more primary data-processing steps specific to the particular method used. At the moment of this writing, the different processing methods are auto- and cross correlation of single-point data, pair-correlation for line or circle scans, burst identification for single-molecule analysis, fluorescence lifetime and anisotropy analysis, phasor FLIM analysis, and generation of image stacks for fluctuation imaging. These calculations are usually the most computationally intensive steps. We have estimated the computation times of the core algorithms for typical data set sizes and found that they perform on timescales faster than 30 s (Fig. S1). For a more efficient workflow, these calculations can additionally be done in a batch analysis, automatically performing the computations with the same settings on multiple similar datasets without the need for direct user interaction. The workflow for some of the most important methods will be discussed in more detail in the following sections.

FCS
FCS is one of the most widely applied quantitative fluorescence analysis methods (34). It can be used to extract information about concentration, diffusion, interactions (23, 35, 36), and conformational dynamics encoded in the fluctuations of the signal (10, 37). The workflow for FCS analysis in PAM is shown in Fig. 4. All calculations of correlation functions are based on the defined photon gates. This photon sorting allows e.g., the removal of spectral cross talk and cross-excitation in multicolor cross correlation spectroscopy (23) or the analysis of two-focus FCS data (38). Furthermore, photons from multiple photon gates or detector channels (e.g., from different polarizations) can be pooled to take advantage of all available photons for maximizing the signal-to-noise ratio. The correlation algorithm is based on a multiple-τ correlation scheme (25). Calculations are performed for all single channels (autocorrelation) or pairs of channels (cross correlation) that were selected by the user. For goodness-of-fit estimation, the data set is automatically divided into time segments that are correlated independently and used to determine the statistical uncertainty.Figure 4 Fluorescence correlation spectroscopy (FCS) in PAM. (A) In FCS, the signal fluctuations arising from the diffusion of molecules in and out of the observation volume are analyzed to extract information about diffusion and interactions. (B) A typical signal trace of an FCS experiment is shown. (C) The workflow for FCS in PAM is shown. The calculation of the correlation function is performed in the FCS submodule of the PAM GUI. The user selects the correlation method and uses the correlation matrix to select which photon gates should be cross-correlated. Quantitative evaluation of the correlation functions is performed in the FCSFit module. Standard fit models are available, and user-defined model functions are easily implemented. The fit result is evaluated by means of goodness-of-fit indicators and confidence intervals for the determined parameters. To see this figure in color, go online.



The standard algorithm only uses the macro-time information to calculate the correlation functions. However, the user can also select to include the micro-time to extend the resolution to the nano- and picosecond regime (25). For data with rapid scanning, the signal can alternatively be divided into different focus positions to perform pairwise correlations between these spatial bins (39). PAM also includes methods to perform statistical filtering during correlation analysis. Usually, the algorithm treats all selected photons equally, giving them a weight of one, but it is also possible to calculate filter functions based on the lifetime (fluorescence lifetime correlation spectroscopy), spectrum (fluorescence spectral correlation spectroscopy), polarization, or a combination of these parameters (10, 40, 41). Additional functions in PAM include an automatic removal of bright aggregates or dust, correction for detector after-pulsing, and batch analysis of multiple data sets.

Once the correlation function is calculated, the data is saved and can be analyzed with the FCSFit module, which is used to fit temporal correlation data. All fitting functions are based on text files, making it easy to modify existing model functions or to create new model functions when needed. The parameters used for fitting can be individually fixed or globally linked between all files currently loaded, and confidence intervals for the fit result can be calculated. The module includes several normalization methods to better compare different measurements and allows direct export of the plots and the fitted parameters.

Burst-wise single-molecule analysis
Single-molecule spectroscopy in solution using burst analysis is a powerful method to obtain single-molecule information about biomolecules with high throughput and no need for surface immobilization. It relies on the free diffusion of molecules through the observation volume of a confocal microscope (Fig. 5
A), which, at low concentration, results in isolated bursts of fluorescence from single molecules (Fig. 5
B) (5, 42). Depending on the excitation and detection scheme used, a number of different parameters can be calculated from the fluorescence signal (1, 2).Figure 5 Single-molecule spectroscopy using burst analysis in PAM. (A) In burst analysis, molecules are labeled with a donor- and acceptor-fluorophore (green and red, respectively). Förster resonance energy transfer (FRET) reports on the distance between them to detect conformational dynamics. (B) At low concentrations, the data consist of bursts of fluorescence when a molecule traverses the focus. The fluorescence of the donor dye is shown in green, and the inverted acceptor signal is shown in red. (C) The workflow for burst analysis in PAM is shown. Burst identification and calculation of burst-wise parameters are performed using the Burst Analysis submodule in the PAM GUI. The processed data set is then explored, filtered, and analyzed in the BurstBrowser module. Finally, selected populations can be subjected to more detailed analysis in the TauFit, FCSFit, and PDAFit modules. To see this figure in color, go online.



The general outline for burst analysis in PAM is given in Fig. 5. Once the experimental setup and the different detection channels have been defined (see Fig. 3
B), an appropriate burst search algorithm has to be selected. PAM offers two different burst search methods using a threshold either on the count rate determined using a sliding time window (26) or on the interphoton time (43). Additionally, the burst search can be performed on all photons together (all-photon burst search) or independently on the photons after donor or acceptor excitation (dual-channel burst search) (26). The latter option allows one to exclude donor- or acceptor-only molecules directly because only events with high signal in both channels will be detected. These events may also be cleaned up after the burst search using the stoichiometry parameter. Most burst-wise parameters are automatically determined after the burst identification step, whereas additional, more computationally expensive parameters are calculated on demand. The burst-wise fluorescence lifetime is determined for both the donor and acceptor fluorophore by a maximum likelihood estimation using a single exponential model function (2, 44). Additionally, the ALEX-2CDE and FRET-2CDE filters can be calculated, which rely on kernel density estimation to detect fluctuations between two channels, allowing the detection of dye blinking and bleaching events (ALEX-2CDE) or FRET fluctuations originating from conformational dynamics (FRET-2CDE) (45).

The simplest scheme for single-molecule FRET by burst analysis is obtained by using a single excitation laser for the FRET donor dye and two spectral detection channels for donor and acceptor fluorescence. The most important parameter available from the experiment is the FRET efficiency, together with general parameters such as the laboratory time of the single-molecule event, the burst duration, or the number of photons. The use of alternating acceptor excitation by means of PIE or ALEX adds the labeling stoichiometry to the parameter space (2, 6). The stoichiometry allows the exclusion of molecules with only a single donor or acceptor dye as well as the investigation of the composition of higher-order complexes. Isolating single-labeled molecules also allows one to obtain the required correction factors directly from the experiment to determine quantitative FRET efficiencies and thus perform accurate distance measurements (2). By the use of pulsed lasers and TCSPC electronics, it is additionally possible to determine the burst-averaged fluorescence lifetime. This introduces an independent alternative to determining the FRET efficiency from the quenching of the donor fluorophore and makes it possible to identify conformational dynamics on the sub-millisecond timescale (8). When polarization-sensitive detection is employed, the fluorescence anisotropy reports on the rotational properties of the fluorophore and the biomolecule, offering a readout for detecting complex formation and the possibility to detect unwanted interactions of the fluorophore with the surface of the biomolecule. Lastly, three-color FRET studies can be performed by implementation of an additional color channel and fluorescent label, which allows more complex questions to be addressed by monitoring three distances simultaneously (32, 46).

The analyzed data are stored in an intermediate file format that can be loaded into the BurstBrowser module for interactive exploration of the data set. Parameter distributions can be examined using 1D or 2D histograms. For comparison between different species of a single measurement or between different datasets, multiple data selections can be defined simultaneously. Quantitative analysis of parameter distributions can be performed by fitting with bivariate normal distributions to obtain distribution means and widths. Important plots related to the fluorescence lifetime information are predefined and can be inspected at a glance, and associated theoretical curves are easily added to these plots for a more quantitative analysis. Molecule selections can further be analyzed by performing subensemble TCSPC analysis of the fluorescence and anisotropy decays, correlation analysis of diffusion and conformational dynamics (purified-FCS and filtered-FCS) (10, 47), and PDA (7, 8) in the modules TauFit, FCSFit, and PDAFit. PDA can be used to analyze static distance heterogeneity using Gaussian distance distributions or to infer interconversion rates in dynamic systems. Additionally, three-color FRET experiments are supported by all described methods. The display of the data can be customized to a high degree, and publication-ready plots are available at all points. Additionally, an integrated database functionality enables the convenient management and cataloging of large measurement series.

Fluctuation imaging
Fluctuation imaging describes a group of methods that apply the concepts of fluorescence fluctuation spectroscopy to image data. These methods can be divided into different categories based on the dimensions used for the analysis. The first group uses only the temporal dimension to extract information and includes TICS (48), also called imaging FCS (49) and number and brightness analysis (17). The second category is based on correlations of the two spatial dimensions and includes ICS (50) and RICS (18, 51). The last group correlates the data through both time and space. STICS (12) and iMSD (52) are examples of these 3D correlation methods. Depending on the particular method used, one can gain information about the size, oligomerization state, and (co)mobility of molecules or even whole cellular structures.

Image fluctuation analysis in PAM is performed with the Microtime Image Analysis (MIA) submodule, and the workflow is illustrated in Fig. 6. It starts with loading the data, either directly from image files, e.g., TIFFs, or from the sorted photon data of the core PAM module. MIA works with up to two channels that can be used for auto- and cross correlation. The user then selects a rectangular region of interest (ROI) that is the basis for all further calculations. Next, individual pixels, regions, and/or frames can be selectively discarded. This arbitrary region selection can be done automatically, e.g., by intensity thresholds, or manually by freehand drawing on either the full image stack or on a frame-by-frame basis. The voids created by the excluded data are accounted for in the correlation algorithms (15). Once the relevant pixels are selected, an image-correction step is performed to remove unwanted contributions from the data. As an example, in a RICS analysis, one is usually only interested in correlations caused by fast-diffusing particles, whereas spatial correlations from the cell shape and the slow movement of large cellular structures interfere with the useful signal. To remove the latter, it is useful to subtract the mean of the pixel intensity over several frames, removing static spatial heterogeneity while retaining fast fluctuations occurring within a few frames. To restore the original average intensity of the image, the mean pixel intensity of each frame or the complete image series is added back to the data. A variety of additional correction methods are available to remove particular contributions for the individual analysis methods (16).Figure 6 Fluctuation imaging in PAM. (A) In fluctuation imaging, the spatial heterogeneity or the temporal dynamics are recorded to analyze the diffusion and interactions of the studied molecules. (B) The workflow for image correlation spectroscopy in PAM is shown. The photon data is sorted into photon gates, and an image series is generated using the pixel, line, or image start-stop times. Alternatively, image data can be directly used for analysis in MIA. A region of interest is selected, and the appropriate corrections are applied to the image series in MIA, e.g., to remove static heterogeneities and slow cell movement. The image correlation function can be loaded in MIAFit for quantitative analysis by fitting to model functions. To see this figure in color, go online.



The final step in MIA is the actual image-correlation calculation (11), either in 1D through time, 2D through space, or in 3D through both time and space, depending on the particular technique used. All correlation functions are displayed directly in MIA for a preliminary analysis, but the main interpretation is done in dedicated fitting modules: either FCSFit for 1D data (TICS and iMSD) or MIAFit for 2D (ICS, RICS) and 3D (STICS) correlation functions. MIAFit works similarly to FCSFit, as described in the previous section, but it is designed to analyze and display 2D data.

Fluorescence lifetime image analysis using the phasor approach
FLIM uses the lifetime of dye molecules to obtain a spatial map of the FRET efficiency, quenching, or the presence of certain analytes in the sample. The phasor approach exploits concepts and rules of the fluorescence decay in the Fourier space to interpret FLIM data in a semiquantitative way without the need to fit the fluorescence decays to single- or multiexponential model functions (27).

The main workflow of phasor analysis in PAM is shown in Fig. 7. The first step involves the calculation of the phasor data for each individual pixel in the phasor panel of the main PAM GUI. This requires reference data with a known monoexponential lifetime that is used to remove the influence of the instrument response function. For TIFF-based time- or frequency-domain FLIM data, an additional module is provided to reference and calculate the phasor data. Once the phasor data are calculated, they are stored in an intermediate file for analysis with the Phasor module. Here, the intensity image is displayed together with a pixel-wise phasor histogram. The user has different options to establish a relationship between the two. The first is to select different ROIs in the phasor plot. The selected pixels are then indicated with the corresponding color in the intensity images. This makes it easy to highlight different, clearly separated lifetime populations in the images. For the second method, the user defines a line or curve in the phasor histogram. The program then projects the pixel phasors on this line and encodes their relative position with a color-map. This is useful to indicate gradual changes of the lifetime. Lastly, it is also possible to plot a quenching trajectory, as is needed, for example, in systems undergoing FRET (53). By accounting for background-signal and unquenched-donor molecules, the FRET efficiency for the population can be estimated. The particular FRET value for the whole trajectory can be indicated in the intensity image via color-coding. As for all modules, all images, histograms, and selected trajectories can be exported to publication-ready plots.Figure 7 Phasor FLIM analysis in PAM. (A) In lifetime imaging, both the signal intensity as well as the information about the lifetime are recorded for every pixel and can be used to investigate molecular interactions or dynamics via FRET or to analyze the local environment of the fluorophores. (B) The workflow for Phasor-FLIM analysis in PAM is shown. A sample with known lifetime is used as reference for the pixel-wise phasor calculation. In the Phasor module, the data set can be explored using the phasor histogram to color-code the intensity image by the fluorescence lifetime, either by using regions of interest (ROIs) defined in the phasor space or by using a gradual lifetime scaling. To see this figure in color, go online.



Conclusions
Here, we presented an overview of our in-house software package PAM, which has been developed and used for many publications from our laboratory and several other groups over the past years. It encompasses a multitude of different quantitative analysis methods within a well-structured and efficient workflow. With the design of PAM, we attempt to encourage novice users to experiment with new methods by providing a user-friendly interface, while simultaneously inviting expert users to contribute and extend the software and the underlying methods through open-source availability. The software is under continuous development with respect to improvements of the user experience and extension of implemented or addition of new methods. Current development projects include the implementation of spectrally resolved data, structure detection for particle- or cell-averaged analysis, and quantitative three-color FRET analysis.

Availability
The software is available as source code, requiring MATLAB or a precompiled, standalone distribution for Windows or MacOS at http://www.cup.uni-muenchen.de/pc/lamb/software/pam.html or hosted in Git repositories under http://www.gitlab.com/PAM-PIE/PAM and http://www.gitlab.com/PAM-PIE/PAMcompiled. Sample data are provided under http://www.gitlab.com/PAM-PIE/PAM-sampledata. A detailed manual is found at http://pam.readthedocs.io.

Author Contributions
A.B. and W.S. designed the core program and the correlation features. A.B. developed the FRET and lifetime sections. W.S. developed the image fluctuation and phasor sections. J.H. contributed to several modules and improved the overall usability of the program. D.C.L. supervised the project and offered advice on the feature development. All authors wrote the manuscript.

Supporting Material
Document S1. Figure S1 and Table S1
 Data S1. Manual for the PAM Software Package
Updated versions of the manual can be found online at http://pam.readthedocs.io.

 Data S2. Source Code of the PAM Software Package
Execution of the program requires MATLAB version R2014b (8.4) or newer. Additional toolboxes are required for some modules.

 Data S3. A Compiled Version of the PAM Software Package for the Windows Operating System
Execution of the program requires the MATLAB runtime version R2016b (9.1) or newer.

 Data S4. A Compiled Version of the PAM Software Package for the MacOS Operating System
Execution of the program requires the MATLAB runtime version R2016b (9.1) or newer.

 Document S2. Article plus Supporting Material
 

Acknowledgments
We gratefully acknowledge code contributions to an earlier version of the software from Volodymyr Kudryavtsev, Matthias Höller, Wolfgang Kügel, Martin Sikor, and Nikolaus Naredi-Rainer as well as contributions to ongoing development by Chen Qian, Nader Al Danaf, Philipp Messer (LMU Munich), Niels Vandenberk, and Guillermo Solís-Fernández (KU Leuven).

D.C.L. gratefully acknowledges the financial support of the Deutsche Forschungsgemeinschaft (SFB1032, B3 and SFB1035, A11) and of Ludwig-Maximilians-Universität through the Center for NanoScience and the BioImaging Network. This work was supported by a grant from the Research Foundation Flanders (FWO Vlaanderen), grant number G0B4915N.

Waldemar Schrimpf and Anders Barth contributed equally to this work.

One figure, one table, and four data files are available at http://www.biophysj.org/biophysj/supplemental/S0006-3495(18)30295-9.
==== Refs
References
1 Widengren J.  Kudryavtsev V.  Seidel C.A.   Single-molecule detection and identification of multiple species by multiparameter fluorescence detection Anal. Chem 78 2006 2039 2050 16536444 
2 Kudryavtsev V.  Sikor M.  Lamb D.C.   Combining MFD and PIE for accurate single-pair Förster resonance energy transfer measurements ChemPhysChem 13 2012 1060 1078 22383292 
3 Tetin S.Y.   Methods in Enzymology, Fluorescence Fluctuation Spectroscopy (FFS), Part A 2013 Elsevier Amsterdam, the Netherlands 
4 Tetin S.Y.   Methods in Enzymology, Fluorescence Fluctuation Spectroscopy (FFS), Part B 2013 Elsevier Amsterdam, the Netherlands 
5 Zander C.  Sauer M.  Seidel C.A.   Detection and characterization of single molecules in aqueous solution Appl. Phys. B 63 1996 517 523 
6 Lee N.K.  Kapanidis A.N.  Weiss S.   Accurate FRET measurements within single diffusing biomolecules using alternating-laser excitation Biophys. J 88 2005 2939 2953 15653725 
7 Antonik M.  Felekyan S.  Seidel C.A.   Separating structural heterogeneities from stochastic variations in fluorescence resonance energy transfer distributions via photon distribution analysis J. Phys. Chem. B 110 2006 6970 6978 16571010 
8 Kalinin S.  Valeri A.  Seidel C.A.   Detection of structural dynamics by FRET: a photon distribution and fluorescence lifetime analysis of systems with multiple states J. Phys. Chem. B 114 2010 7983 7995 20486698 
9 Eggeling C.  Fries J.R.  Seidel C.A.   Monitoring conformational dynamics of a single molecule by selective fluorescence spectroscopy Proc. Natl. Acad. Sci. USA 95 1998 1556 1561 9465054 
10 Felekyan S.  Kalinin S.  Seidel C.A.   Filtered FCS: species auto- and cross-correlation functions highlight binding and dynamics in biomolecules ChemPhysChem 13 2012 1036 1053 22407544 
11 Petersen N.O.  Höddelius P.L.  Magnusson K.E.   Quantitation of membrane receptor distributions by image correlation spectroscopy: concept and application Biophys. J 65 1993 1135 1146 8241393 
12 Hebert B.  Costantino S.  Wiseman P.W.   Spatiotemporal image correlation spectroscopy (STICS) theory, verification, and application to protein velocity mapping in living CHO cells Biophys. J 88 2005 3601 3614 15722439 
13 Kolin D.L.  Ronis D.  Wiseman P.W.   k-Space image correlation spectroscopy: a method for accurate transport measurements independent of fluorophore photophysics Biophys. J 91 2006 3061 3075 16861272 
14 Toplak T.  Pandzic E.  Wiseman P.W.   STICCS reveals matrix-dependent adhesion slipping and gripping in migrating cells Biophys. J 103 2012 1672 1682 23083710 
15 Hendrix J.  Dekens T.  Lamb D.C.   Arbitrary-region raster image correlation spectroscopy Biophys. J 111 2016 1785 1796 27760364 
16 Hendrix J.  Schrimpf W.  Lamb D.C.   Pulsed interleaved excitation fluctuation imaging Biophys. J 105 2013 848 861 23972837 
17 Digman M.A.  Dalal R.  Gratton E.   Mapping the number of molecules and brightness in the laser scanning microscope Biophys. J 94 2008 2320 2332 18096627 
18 Digman M.A.  Brown C.M.  Gratton E.   Measuring fast dynamics in solutions and cells with a laser scanning microscope Biophys. J 89 2005 1317 1327 15908582 
19 Murphy R.R.  Jackson S.E.  Klenerman D.   pyFRET: a python library for single molecule fluorescence data analysis arXiv 2014 
20 Ingargiola A.  Lerner E.  Michalet X.   FRETBursts: an open source toolkit for analysis of freely-diffusing single-molecule FRET PLoS One 11 2016 e0160716 27532626 
21 Preus S.  Noer S.L.  Birkedal V.   iSMS: single-molecule FRET microscopy software Nat. Methods 12 2015 593 594 26125588 
22 Müller P.  Schwille P.  Weidemann T.   PyCorrFit-generic data evaluation for fluorescence correlation spectroscopy Bioinformatics 30 2014 2532 2533 24825612 
23 Müller B.K.  Zaychikov E.  Lamb D.C.   Pulsed interleaved excitation Biophys. J 89 2005 3508 3522 16113120 
24 Elson E.L.   40 years of FCS: how it all began Methods Enzymol 518 2013 1 10 23276533 
25 Felekyan S.  Kühnemuth R.  Seidel C.A.   Full correlation from picoseconds to seconds by time-resolved and time-correlated single photon detection Rev. Sci. Instrum 76 2005 083104 
26 Nir E.  Michalet X.  Weiss S.   Shot-noise limited single-molecule FRET histograms: comparison between theory and experiments J. Phys. Chem. B 110 2006 22103 22124 17078646 
27 Digman M.A.  Caiolfa V.R.  Gratton E.   The phasor approach to fluorescence lifetime imaging analysis Biophys. J 94 2008 L14 L16 17981902 
28 Wiseman P.W.   Image Correlation Spectroscopy: Mapping Correlations in Space, Time, and Reciprocal Space First Edition 2013 Elsevier Inc Amsterdam, the Netherlands 
29 Hendrix J.  Baumgärtel V.  Lamb D.C.   Live-cell observation of cytosolic HIV-1 assembly onset reveals RNA-interacting Gag oligomers J. Cell Biol 210 2015 629 646 26283800 
30 Otosu T.  Ishii K.  Tahara T.   Note: simple calibration of the counting-rate dependence of the timing shift of single photon avalanche diodes by photon interval analysis Rev. Sci. Instrum 84 2013 036105 23556857 
31 Kapanidis A.N.  Lee N.K.  Weiss S.   Fluorescence-aided molecule sorting: analysis of structure and interactions by alternating-laser excitation of single molecules Proc. Natl. Acad. Sci. USA 101 2004 8936 8941 15175430 
32 Lee N.K.  Kapanidis A.N.  Weiss S.   Three-color alternating-laser excitation of single molecules: monitoring multiple interactions and distances Biophys. J 92 2007 303 312 17040983 
33 Lee J.  Lee S.  Hohng S.   Single-molecule four-color FRET Angew. Chem. Int. Ed. Engl 49 2010 9922 9925 21104966 
34 Magde D.  Elson E.  Webb W.W.   Fluorescence correlation spectroscopy Phys. Rev. Lett 29 1972 705 
35 Schwille P.  Meyer-Almes F.J.  Rigler R.   Dual-color fluorescence cross-correlation spectroscopy for multicomponent diffusional analysis in solution Biophys. J 72 1997 1878 1886 9083691 
36 Weidemann T.  Schwille P.   Dual-Color Fluorescence Cross-Correlation Spectroscopy with Continuous Laser Excitation in a Confocal Setup First Edition 2013 Elsevier Inc Amsterdam, the Netherlands 
37 Felekyan S.  Sanabria H.  Seidel C.A.   Analyzing Förster Resonance Energy Transfer with Fluctuation Algorithms First Edition 2013 Elsevier Inc Amsterdam, the Netherlands 
38 Dertinger T.  Pacheco V.  Enderlein J.   Two-focus fluorescence correlation spectroscopy: a new tool for accurate and absolute diffusion measurements ChemPhysChem 8 2007 433 443 17269116 
39 Digman M.A.  Gratton E.   Imaging barriers to diffusion by pair correlation functions Biophys. J 97 2009 665 673 19619481 
40 Kapusta P.  Wahl M.  Enderlein J.   Fluorescence lifetime correlation spectroscopy J. Fluoresc 17 2007 43 48 17171439 
41 Benda A.  Kapusta P.  Gaus K.   Fluorescence spectral correlation spectroscopy (FSCS) for probes with highly overlapping emission spectra Opt. Express 22 2014 2973 2988 24663589 
42 Brooks Shera E.  Seitzinger N.K.  Soper S.A.   Detection of single fluorescent molecules Chem. Phys. Lett 174 1990 553 557 
43 Schaffer J.  Volkmer A.  Seidel C.A.   Identification of single molecules in aqueous solution by time-resolved fluorescence anisotropy J. Phys. Chem. A 103 1999 331 336 
44 Maus M.  Cotlet M.  Seidel C.A.   An experimental comparison of the maximum likelihood estimation and nonlinear least-squares fluorescence lifetime analysis of single molecules Anal. Chem 73 2001 2078 2086 11354494 
45 Tomov T.E.  Tsukanov R.  Nir E.   Disentangling subpopulations in single-molecule FRET and ALEX experiments with photon distribution analysis Biophys. J 102 2012 1163 1173 22404939 
46 Clamme J.P.  Deniz A.A.   Three-color single-molecule fluorescence resonance energy transfer ChemPhysChem 6 2005 74 77 15688649 
47 Laurence T.A.  Kwon Y.  Barsky D.   Correlation spectroscopy of minor fluorescent species: signal purification and distribution analysis Biophys. J 92 2007 2184 2198 17189306 
48 Srivastava M.  Petersen N.O.   Diffusion of transferrin receptor clusters Biophys. Chem 75 1998 201 211 9894339 
49 Krieger J.W.  Singh A.P.  Wohland T.   Imaging fluorescence (cross-) correlation spectroscopy in live cells and organisms Nat. Protoc 10 2015 1948 1974 26540588 
50 Kolin D.L.  Wiseman P.W.   Advances in image correlation spectroscopy: measuring number densities, aggregation states, and dynamics of fluorescently labeled macromolecules in cells Cell Biochem. Biophys 49 2007 141 164 17952641 
51 Digman M.A.  Wiseman P.W.  Gratton E.   Detecting protein complexes in living cells from laser scanning confocal image sequences by the cross correlation raster image spectroscopy method Biophys. J 96 2009 707 716 19167315 
52 Di Rienzo C.  Gratton E.  Cardarelli F.   Fast spatiotemporal correlation spectroscopy to determine protein lateral diffusion laws in live cell membranes Proc. Natl. Acad. Sci. USA 110 2013 12307 12312 23836651 
53 Hinde E.  Digman M.A.  Gratton E.   Biosensor Förster resonance energy transfer detection by the phasor approach to fluorescence lifetime imaging microscopy Microsc. Res. Tech 75 2012 271 281 21858900

